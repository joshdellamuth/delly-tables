(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class d{constructor(t,e){this.x=t,this.y=e}}const h=class h{};h.TopEdge="top-edge",h.BottomEdge="bottom-edge",h.RightEdge="right-edge",h.LeftEdge="left-edge",h.TopLeftCorner="top-left-corner",h.TopRightCorner="top-right-corner",h.BottomLeftCorner="bottom-left-corner",h.BottomRightCorner="bottom-right-corner",h.Inside="inside",h.NotOn="not-on";let a=h;class m{constructor(t,e,i,s,n,o,l=!1){this.gridPosition=new d(null,null),this.screenPosition=new d(null,null),this.padding=10,this.minimumWidth=30,this.minimumHeight=30,this.isSelected=!1,this.x1=null,this.y1=null,this.x2=null,this.y2=null,this.lastMousePosition=a.NotOn,this.hoveringMousePosition=a.NotOn,this.ID=t,this.gridPosition.x=n,this.gridPosition.y=o,this.width=e,this.height=i,this.color=s,this.isSelected=l}resize(t){switch(this.lastMousePosition){case a.BottomRightCorner:let e=t.x-this.gridPosition.x,i=t.y-this.gridPosition.y;e>this.minimumWidth&&(this.width=e),i>this.minimumHeight&&(this.height=i);break;case a.TopLeftCorner:const s=t.x,n=t.y,o=this.gridPosition.x,l=this.gridPosition.y,c=o+this.width-s,g=l+this.height-n;c>this.minimumWidth&&(this.gridPosition.x=s,this.width=c),g>this.minimumHeight&&(this.gridPosition.y=n,this.height=g);break;case a.LeftEdge:const u=t.x,f=this.gridPosition.x,y=f+this.width-u;y>=this.minimumWidth?(this.gridPosition.x=u,this.width=y):(this.gridPosition.x=f+this.width-this.minimumWidth,this.width=this.minimumWidth);break}}getMousePosOnDrawable(t){const e=this.gridPosition.x,i=this.gridPosition.y,s=this.gridPosition.x+this.width,n=this.gridPosition.y+this.height;if(t.x===null||t.y===null)return this.lastMousePosition=a.NotOn,a.NotOn;if(t.x<e-this.padding||t.x>s+this.padding||t.y<i-this.padding||t.y>n+this.padding)return this.lastMousePosition=a.NotOn,a.NotOn;const o=t.x>=e-this.padding&&t.x<=e+this.padding,l=t.x>=s-this.padding&&t.x<=s+this.padding,c=t.y>=i-this.padding&&t.y<=i+this.padding,g=t.y>=n-this.padding&&t.y<=n+this.padding;return o&&c?(this.lastMousePosition=a.TopLeftCorner,a.TopLeftCorner):l&&c?(this.lastMousePosition=a.TopRightCorner,a.TopRightCorner):o&&g?(this.lastMousePosition=a.BottomLeftCorner,a.BottomLeftCorner):l&&g?(this.lastMousePosition=a.BottomRightCorner,a.BottomRightCorner):o?(this.lastMousePosition=a.LeftEdge,a.LeftEdge):l?(this.lastMousePosition=a.RightEdge,a.RightEdge):c?(this.lastMousePosition=a.TopEdge,a.TopEdge):g?(this.lastMousePosition=a.BottomEdge,a.BottomEdge):(this.lastMousePosition=a.Inside,a.Inside)}draw(t,e,i){let s=8;this.x1=this.gridPosition.x,this.y1=this.gridPosition.y,this.x2=this.gridPosition.x+this.width,this.y2=this.gridPosition.y+this.height,t.fillStyle=this.color,t.beginPath(),t.moveTo(this.x1,this.y1),t.arcTo(this.x2,this.y1,this.x2,this.y2,s),t.arcTo(this.x2,this.y2,this.x1,this.y2,s),t.arcTo(this.x1,this.y2,this.x1,this.y1,s),t.arcTo(this.x1,this.y1,this.x2,this.y1,s),t.closePath(),t.fill(),this.isSelected&&this.drawSelectionOutline(t,this.x1,this.y1,this.x2,this.y2,s)}drawSelectionOutline(t,e,i,s,n,o){t.save(),t.strokeStyle="skyblue",t.lineWidth=3,t.setLineDash([14,8]),t.beginPath(),t.moveTo(e+this.width/2,i),t.arcTo(s,i,s,n,o),t.arcTo(s,n,e,n,o),t.arcTo(e,n,e,i,o),t.arcTo(e,i,s,i,o),t.closePath(),t.stroke();const l=[[e,i],[s,i],[s,n],[e,n]],c=[[(e+s)/2,i],[s,(i+n)/2],[(e+s)/2,n],[e,(i+n)/2]];[...l,...c].forEach(([u,f])=>{t.beginPath(),t.arc(u,f,4,0,Math.PI*2),t.fillStyle="skyblue",t.fill()}),t.restore()}updateScreenPosition(t){this.screenPosition.x=t.x,this.screenPosition.y=t.y}}class D{constructor(){this._scale=1,this._panX=0,this._panY=0}get scale(){return this._scale}get panX(){return this._panX}get panY(){return this._panY}zoom(t,e,i){const n=t<0?1.18:.8474576271186441,o=this._scale*n;this._panX=e-(e-this._panX)*(o/this._scale),this._panY=i-(i-this._panY)*(o/this._scale),this._scale=o}pan(t,e){this._panX+=t,this._panY+=e}screenToGrid(t){return new d((t.x-this._panX)/this._scale,(t.y-this._panY)/this._scale)}convertToScreenPos(t,e,i,s,n){const o=e.getBoundingClientRect(),l=t.x-o.left,c=t.y-o.top,g=(l-i)/n,u=(c-s)/n;return new d(g,u)}}class z{constructor(t){this._canvas=t}setStyleByHoveringStatus(t){switch(t){case a.BottomEdge:case a.TopEdge:this._canvas.style.cursor="n-resize";break;case a.RightEdge:case a.LeftEdge:this._canvas.style.cursor="w-resize";break;case a.TopLeftCorner:this._canvas.style.cursor="nw-resize";break;case a.TopRightCorner:this._canvas.style.cursor="ne-resize";break;case a.BottomLeftCorner:this._canvas.style.cursor="sw-resize";break;case a.BottomRightCorner:this._canvas.style.cursor="se-resize";break;case a.Inside:this._canvas.style.cursor="move";break;case a.NotOn:this._canvas.style.cursor="default";break}}setStyleMove(){this._canvas.style.cursor="move"}setStyleGrabbing(){this._canvas.style.cursor="grabbing"}setStyleGrab(){this._canvas.style.cursor="grab"}setStyleDefault(){this._canvas.style.cursor="default"}}class B{constructor(){this.mouseScreenPos=new d(null,null),this.mouseGridPos=new d(null,null),this.isPanning=!1,this.panStart=new d(null,null)}get mouseScreenPosition(){return this.mouseScreenPos}get mouseGridPosition(){return new d(this.mouseGridPos.x,this.mouseGridPos.y)}get isPanningActive(){return this.isPanning}updateMousePosition(t,e,i,s){const n=t.getBoundingClientRect();this.mouseScreenPos.x=e-n.left,this.mouseScreenPos.y=i-n.top;const o=s.screenToGrid(new d(this.mouseScreenPos.x,this.mouseScreenPos.y));this.mouseGridPos.x=o.x,this.mouseGridPos.y=o.y}startPanning(t,e){this.isPanning=!0,this.panStart.x=t,this.panStart.y=e}updatePanning(t,e){if(!this.isPanning||this.panStart.x===null||this.panStart.y===null)return{deltaX:0,deltaY:0};const i=t-this.panStart.x,s=e-this.panStart.y;return this.panStart.x=t,this.panStart.y=e,{deltaX:i,deltaY:s}}stopPanning(){this.isPanning=!1,this.panStart.x=null,this.panStart.y=null}}class R{constructor(t,e){this.selectedDrawable=null,this.isDragging=!1,this.isResizing=!1,this.dragOffset=new d(null,null),this.drawables=[],this.ctx=e,this.canvas=t}get selected(){return this.selectedDrawable}get isDraggingShape(){return this.isDragging}get isResizingShape(){return this.isResizing}selectDrawable(t,e){this.selectedDrawable=t,t.isSelected=!0,this.dragOffset.x=e.x-t.gridPosition.x,this.dragOffset.y=e.y-t.gridPosition.y}updateDrag(t){this.isDragging&&this.selectedDrawable&&t.x!==null&&t.y!==null&&(this.selectedDrawable.gridPosition.x=t.x-this.dragOffset.x,this.selectedDrawable.gridPosition.y=t.y-this.dragOffset.y)}clearSelection(){this.drawables.forEach(t=>{t.isSelected=!1})}startDragging(){this.isDragging=!0,this.isResizing=!1}stopDragging(){this.isDragging=!1}startResizing(){this.isResizing=!0,this.isDragging=!1}stopResizing(){this.isResizing=!1}updateResizing(t){this.isDragging&&this.selectedDrawable&&t.x!==null&&t.y!==null&&(this.selectedDrawable.gridPosition.x=t.x-this.dragOffset.x,this.selectedDrawable.gridPosition.y=t.y-this.dragOffset.y)}trySelectAt(t){for(let e=this.drawables.length-1;e>=0;e--){const i=this.drawables[e];if(i.getMousePosOnDrawable(t)!=a.NotOn)return this.clearSelection(),this.selectDrawable(i,t),!0}return!1}drawObjects(t,e,i){this.drawables.forEach(s=>{const n=e.convertToScreenPos(s.gridPosition,i,e.panX,e.panY,e.scale);s.updateScreenPosition(n),s.draw(t,e.panX,e.panY)})}clear(t,e){this.ctx.clearRect(0,0,t,e)}render(t,e){this.clear(e.width,e.height),this.ctx.save(),this.ctx.translate(t.panX,t.panY),this.ctx.scale(t.scale,t.scale),this.drawObjects(this.ctx,t,this.canvas),this.ctx.restore()}}class T{constructor(t,e){this.width=t,this.height=e}}class C{constructor(t,e,i,s){this.viewport=new D,this.inputManager=new B,this.size=new T(0,0),this.ID=t,this.canvas=document.getElementById(t);const n=this.canvas.getContext("2d");this.drawablesManager=new R(this.canvas,n),this.mouse=new z(this.canvas),this.updateSize(e,i),s&&(this.drawablesManager.drawables=s),this.setupEventListeners(),this.render(),this.updateDebugValues()}render(){this.drawablesManager.render(this.viewport,this.canvas)}setupEventListeners(){this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this))}handleMouseDown(t){if(t.button===0){if(this.drawablesManager.trySelectAt(this.inputManager.mouseGridPosition)?this.mouse.setStyleMove():this.drawablesManager.clearSelection(),this.drawablesManager.selected!=null){let i=this.drawablesManager.selected;i.lastMousePosition===a.Inside?this.drawablesManager.startDragging():i.lastMousePosition===a.NotOn||this.drawablesManager.startResizing()}this.render(),this.updateDebugValues()}t.button===2&&(this.inputManager.startPanning(t.clientX,t.clientY),this.mouse.setStyleGrab())}handleMouseMove(t){if(this.inputManager.updateMousePosition(this.canvas,t.clientX,t.clientY,this.viewport),this.updateDebugValues(),this.drawablesManager.isDraggingShape){this.drawablesManager.updateDrag(this.inputManager.mouseGridPosition),this.render(),this.updateDebugValues();return}if(this.inputManager.isPanningActive){this.mouse.setStyleGrabbing();const{deltaX:s,deltaY:n}=this.inputManager.updatePanning(t.clientX,t.clientY);this.viewport.pan(s,n)}let e=this.drawablesManager.selected,i=this.inputManager.mouseGridPosition;if(e!=null){let s=e.hoveringMousePosition;console.log(`Hovering status: ${s}`),this.mouse.setStyleByHoveringStatus(s),this.drawablesManager.isResizingShape&&(e.resize(i),this.render(),this.updateDebugValues())}this.render(),this.updateDebugValues()}handleMouseUp(){this.mouse.setStyleDefault(),this.drawablesManager.stopDragging(),this.inputManager.stopPanning(),this.drawablesManager.stopResizing(),this.updateDebugValues()}handleMouseLeave(){this.inputManager.stopPanning(),this.drawablesManager.stopDragging(),this.updateDebugValues()}handleWheel(t){const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;this.viewport.zoom(t.deltaY,i,s),this.render(),this.updateDebugValues()}updateSize(t,e){this.size.width=t,this.size.height=e,this.canvas.width=this.size.width,this.canvas.height=this.size.height}updateDebugValues(){const t=document.getElementById("debuggingValues");if(!t)return;const e=this.inputManager.mouseGridPosition,i=this.inputManager.mouseScreenPosition,s=this.drawablesManager.selected;t.innerText=`| scale: ${this.viewport.scale.toFixed(8)} | panX: ${this.viewport.panX.toFixed(8)} | panY: ${this.viewport.panY.toFixed(8)} | isPanning: ${this.inputManager.isPanningActive} | mouseGrid: ${e.x?.toFixed(8)??"null"}, ${e.y?.toFixed(8)??"null"} | mouseScreen: ${i.x?.toFixed(8)??"null"}, ${i.y?.toFixed(8)??"null"} | selected: '${s?.ID??"none"}.'| dragging: '${this.drawablesManager.isDraggingShape??"none"}.'| resizing: ${this.drawablesManager.isResizingShape} |`}}function X(){const r=window.location.hostname;if(r==="localhost"||r==="127.0.0.1")return"http://localhost:5500/src/delly-tables-ui/";if(r==="joshdellamuth.github.io")return"https://joshdellamuth.github.io/delly-tables/";{const t=new Error("Unknown hostname: "+r);throw alert("Error: "+t.message),t}}let Y=X();console.log(`The base URL is ${Y}.`);const p=[],_=new m("blue-box-1",200,100,"#5c9dffff",100,100);p.push(_);const I=new m("pink-box-1",200,200,"#aa269fff",400,500);p.push(I);const O=new m("teal-box-1",200,300,"#8ef7ffff",750,300);p.push(O);const k=new m("orange-box-1",100,300,"#ecaf2aff",600,-300);p.push(k);const v=document.getElementById("collapse-button"),b=document.getElementById("uncollapse-button"),N=document.getElementById("admin-page");function W(){window.location.href="admin.html"}const M=document.getElementById("file-button"),P=document.getElementById("export-button"),S=document.getElementById("help-button"),x=document.getElementById("logo-text"),L=document.getElementById("logo-image");let w=!0;V(w);N?.addEventListener("click",()=>{console.log("Admin page button clicked."),W()});b?.addEventListener("click",()=>{console.log("Uncollapse button clicked."),E()});function V(r){r?(console.log("Collapsed"),E()):(console.log("Uncollapsed"),$())}function $(){b?.classList.remove("invisible"),v?.classList.add("invisible"),M?.classList.add("invisible"),P?.classList.add("invisible"),S?.classList.add("invisible"),x?.classList.add("invisible"),L?.classList.remove("invisible"),w=!1}function E(){v?.classList.remove("invisible"),b?.classList.add("invisible"),M?.classList.remove("invisible"),P?.classList.remove("invisible"),S?.classList.remove("invisible"),x?.classList.remove("invisible"),L?.classList.add("invisible"),w=!0}const F=window.innerWidth,H=window.innerHeight,G=new C("canvas",F,H,p);window.addEventListener("resize",()=>{const r=window.innerWidth,t=window.innerHeight;G.updateSize(r,t)});
